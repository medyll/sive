<!-- 6-versioning-validation.md -->

## 6. Versioning & Validation

The versioning system allows the author to lock key milestones of their manuscript and return to them at any time. A **Harden** is a versioning snapshot — the equivalent of a named commit. It captures the complete state of the project at a given moment: narrative text, bible, timeline, character sheets.

### 6.1 Harden — Creating a Version

The author triggers a Harden via a dedicated button in the main toolbar. A description message is required before confirming — it can be entered manually or **auto-generated by the AI**, which analyses the diff since the previous version to propose a change summary (e.g. "Rewrote chapter 3, added Martin's death, updated Jean↔Marie relationship"). The author can accept, edit or replace the proposal. The Harden copies all project files into an isolated versioned folder.

Physical version structure:

```
mybook/
└── .harden/
    ├── index.yaml                 ← registry of all versions
    ├── h001_incipit/
    │   ├── meta.yaml              ← timestamp, message, statistics
    │   ├── bible.yaml
    │   ├── timeline.yaml
    │   ├── characters/
    │   └── chapters/
    │       ├── chapter_01/
    │       │   ├── chapter_01.md
    │       │   └── chapter_01.yaml
    │       └── ...
    └── h002_end_act_1/
        ├── meta.yaml
        └── ...
```

`index.yaml` schema — version registry:

```yaml
# .harden/index.yaml

snapshots:
  - id: h001
    label: incipit
    timestamp: 2024-03-15T14:32:00
    author: Jean-Michel
    message: "First draft of the first 3 chapters"
    word_count: 8450
    chapters_included: [chapter_01, chapter_02, chapter_03]

  - id: h002
    label: end_act_1
    timestamp: 2024-04-02T09:15:00
    author: Jean-Michel
    message: "Act 1 complete, Martin's death confirmed"
    word_count: 21300
    chapters_included: [chapter_01, chapter_02, chapter_03, chapter_04]
```

`meta.yaml` schema — version detail:

```yaml
# .harden/h002_end_act_1/meta.yaml

id: h002
label: end_act_1
timestamp: 2024-04-02T09:15:00
author: Jean-Michel
message: "Act 1 complete, Martin's death confirmed"
word_count: 21300
chapter_count: 4

diff_from_previous:
  chapters_modified: [chapter_02, chapter_03]
  chapters_added: [chapter_04]
  chapters_removed: []
  characters_modified: [jean_dupont]
  objects_modified: []
  relations_modified: [jean_dupont↔marie_chen]
  word_delta: +12850
```

### 6.2 Timeline — Navigating Versions

Visual interface as a chronological timeline. Each Harden appears as a point on the timeline with its label and message. The author can navigate between versions and restore any previous version in one click.

The timeline reads `index.yaml` to build the display. The `diff_from_previous` in `meta.yaml` is pre-calculated at Harden creation for instant display.

### 6.3 Visual Diff Between Two Versions

Side-by-side comparison of two Hardens selected on the timeline. Modified passages are highlighted with additions (green) and deletions (red), on both the narrative text (.md) and structured data (.yaml).

### 6.4 Selective Validation of AI Suggestions

Injection of right-panel proposals into the left editor, passage by passage. The author accepts or rejects each proposal independently. Distinct from versioning — selective validation operates on the current draft, before any Harden.

---
