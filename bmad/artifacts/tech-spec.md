# Tech Spec â€” First Draft

This document outlines the initial technical specification for Sive (MVP). It focuses on architecture, data model, authentication, deployment, and developer workflows.

## 1. Architecture Overview

- Frontend: SvelteKit (Svelte v5) served by Vite for development and static/server builds.
- Backend: SvelteKit server endpoints (server routes) for API-like handlers; no separate Node server planned for MVP.
- Database: SQLite via Drizzle ORM (drizzle-orm). Local dev uses `better-sqlite3`.
- Authentication: Better-Auth configured with `drizzleAdapter` to persist sessions/users in the Drizzle-managed DB.

Design goals:
- Minimal infra for fast iteration.
- Clear separation of server-only code (`+page.server.ts`, `src/lib/server`) and client UI (`.svelte`).

## 2. Data Model (Drizzle)

Core tables (MVP):
- `users`: id, email, name, created_at
- `sessions`: id, user_id, expires, data (handled by Better-Auth adapter schema)
- `posts` (or `pages`): id, author_id, title, content, status, created_at, updated_at

Notes:
- Keep schema definitions in `src/lib/server/db/schema.ts`.
- Any schema changes must be accompanied by Drizzle migrations (`npm run db:generate` / `db:migrate`).

## 3. Auth Integration (Better-Auth)

Integration summary:
- Initialize Better-Auth in `src/lib/server/auth.ts` using `drizzleAdapter(db, { provider: 'sqlite' })`.
- Ensure `sveltekitCookies(getRequestEvent)` remains the last plugin in the plugin chain (hooks depend on this ordering).
- Use `auth.api.getSession()` in `hooks.server.ts` to populate `event.locals.session` and `event.locals.user`.

Credentials & Secrets:
- `BETTER_AUTH_SECRET` (env)
- OAuth provider client ids/secrets (optional): `GITHUB_CLIENT_ID`, `GITHUB_CLIENT_SECRET`

Security notes:
- Use secure cookies, SameSite and `ORIGIN` in env for provider callbacks.

## 4. Dev, Tests & CI

Local dev:
- `pnpm install` (preferred) or `npm install`
- `pnpm dev` / `npm run dev` to start Vite + SvelteKit

Tests:
- Unit: Vitest (`npm run test:unit`)
- E2E: Playwright (`npm run test:e2e`)

CI suggestions:
- Run `npm run lint` and `npm run test` on PRs.
- Use a step to run `db:generate` only when DB schema files changed (or run full migration in integration pipeline).

## 5. Deployment

Options:
- Static adapter (if app is mostly static with serverless functions) or default SvelteKit adapters depending on target host.
- For MVP, deploy to platforms that support Node server or Vercel/Netlify with SvelteKit adapters.

## 6. Operational Notes

- Backups: export SQLite DB periodically for production (or plan a move to a managed DB for scale).
- Logs: capture server logs from SvelteKit host provider.

## 7. Next Steps

1. Run `/analyze-context` to extract current schema and confirm `src/lib/server/db/schema.ts` contents.
2. Generate a PRD from repo analysis (`/prd`).
3. Add CI pipeline snippets for lint/test and Drizzle migration safety.

---

Generated by `bmad-master` as a first draft; refine with project-specific details.